<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Filesystem-backed database containing all the information about a chain."><title>smoldot::database::full_sqlite - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../static.files/rustdoc-5bc39a1768837dd0.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="smoldot" data-themes="" data-resource-suffix="" data-rustdoc-version="1.77.1 (7cf61ebde 2024-03-27)" data-channel="1.77.1" data-search-js="search-dd67cee4cfa65049.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../../static.files/storage-4c98445ec4002617.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../static.files/main-48f368f3872407c8.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-04d5337699b92874.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../smoldot/index.html">smoldot</a><span class="version">0.17.0</span></h2></div><h2 class="location"><a href="#">Module full_sqlite</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#functions">Functions</a></li></ul></section><h2><a href="../index.html">In smoldot::database</a></h2></div></nav><div class="sidebar-resizer"></div>
    <main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><div id="sidebar-button" tabindex="-1"><a href="../../../smoldot/all.html" title="show sidebar"></a></div><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" tabindex="-1"><a href="../../../help.html" title="help">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../../index.html">smoldot</a>::<wbr><a href="../index.html">database</a>::<wbr><a class="mod" href="#">full_sqlite</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../../../src/smoldot/database/full_sqlite.rs.html#18-1843">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Filesystem-backed database containing all the information about a chain.</p>
<p>This module handles the persistent storage of the chain on disk.</p>
<h2 id="usage"><a class="doc-anchor" href="#usage">§</a>Usage</h2>
<p>Use the <a href="fn.open.html" title="fn smoldot::database::full_sqlite::open"><code>open()</code></a> function to create a new database or open an existing one. <a href="fn.open.html" title="fn smoldot::database::full_sqlite::open"><code>open()</code></a>
returns a <a href="enum.DatabaseOpen.html" title="enum smoldot::database::full_sqlite::DatabaseOpen"><code>DatabaseOpen</code></a> enum. This enum will contain either a <a href="struct.SqliteFullDatabase.html" title="struct smoldot::database::full_sqlite::SqliteFullDatabase"><code>SqliteFullDatabase</code></a> object,
representing an access to the database, or a <a href="struct.DatabaseEmpty.html" title="struct smoldot::database::full_sqlite::DatabaseEmpty"><code>DatabaseEmpty</code></a> if the database didn’t exist or
is empty. If that is the case, use <a href="struct.DatabaseEmpty.html#method.initialize" title="method smoldot::database::full_sqlite::DatabaseEmpty::initialize"><code>DatabaseEmpty::initialize</code></a> in order to populate it and
obtain a <a href="struct.SqliteFullDatabase.html" title="struct smoldot::database::full_sqlite::SqliteFullDatabase"><code>SqliteFullDatabase</code></a>.</p>
<p>Use <a href="struct.SqliteFullDatabase.html#method.insert" title="method smoldot::database::full_sqlite::SqliteFullDatabase::insert"><code>SqliteFullDatabase::insert</code></a> to insert a new block in the database. The block is assumed
to have been successfully verified prior to insertion. An error is returned if this block is
already in the database or isn’t a descendant or ancestor of the latest finalized block.</p>
<p>Use <a href="struct.SqliteFullDatabase.html#method.set_finalized" title="method smoldot::database::full_sqlite::SqliteFullDatabase::set_finalized"><code>SqliteFullDatabase::set_finalized</code></a> to mark a block already in the database as finalized.
Any block that isn’t an ancestor or descendant will be removed. Reverting finalization is
not supported.</p>
<p>In order to minimize disk usage, it is not possible to efficiently retrieve the storage items
of blocks that are ancestors of the finalized block. When a block is finalized, the storage of
its ancestors is lost, and the only way to reconstruct it is to execute all blocks starting
from the genesis to the desired one.</p>
<h2 id="about-errors-handling"><a class="doc-anchor" href="#about-errors-handling">§</a>About errors handling</h2>
<p>Most of the functions and methods in this module return a <code>Result</code> containing notably an
<a href="enum.CorruptedError.html" title="enum smoldot::database::full_sqlite::CorruptedError"><code>CorruptedError</code></a>. This kind of errors can happen if the operating system returns an error
when accessing the file system, or if the database has been corrupted, for example by the user
manually modifying it.</p>
<p>There isn’t much that can be done to properly handle an <a href="enum.CorruptedError.html" title="enum smoldot::database::full_sqlite::CorruptedError"><code>CorruptedError</code></a>. The only
reasonable solutions are either to stop the program, or to delete the entire database and
recreate it.</p>
<h2 id="schema"><a class="doc-anchor" href="#schema">§</a>Schema</h2>
<p>The SQL schema of the database, with explanatory comments, can be found in <code>open.rs</code>.</p>
<h2 id="about-blocking-behavior"><a class="doc-anchor" href="#about-blocking-behavior">§</a>About blocking behavior</h2>
<p>This implementation uses the SQLite library, which isn’t Rust-asynchronous-compatible. Many
functions will, with the help of the operating system, put the current thread to sleep while
waiting for an I/O operation to finish. In the context of asynchronous Rust, this is
undesirable.</p>
<p>For this reason, you are encouraged to isolate the database in its own threads and never
access it directly from an asynchronous context.</p>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.Config.html" title="struct smoldot::database::full_sqlite::Config">Config</a></div><div class="desc docblock-short">Configuration for the database.</div></li><li><div class="item-name"><a class="struct" href="struct.DatabaseEmpty.html" title="struct smoldot::database::full_sqlite::DatabaseEmpty">DatabaseEmpty</a></div><div class="desc docblock-short">An open database. Holds file descriptors.</div></li><li><div class="item-name"><a class="struct" href="struct.InsertTrieNode.html" title="struct smoldot::database::full_sqlite::InsertTrieNode">InsertTrieNode</a></div></li><li><div class="item-name"><a class="struct" href="struct.InternalError.html" title="struct smoldot::database::full_sqlite::InternalError">InternalError</a></div><div class="desc docblock-short">Low-level database error, such as an error while accessing the file system.</div></li><li><div class="item-name"><a class="struct" href="struct.MissingTrieNode.html" title="struct smoldot::database::full_sqlite::MissingTrieNode">MissingTrieNode</a></div><div class="desc docblock-short">See <a href="struct.SqliteFullDatabase.html#method.finalized_and_above_missing_trie_nodes_unordered" title="method smoldot::database::full_sqlite::SqliteFullDatabase::finalized_and_above_missing_trie_nodes_unordered"><code>SqliteFullDatabase::finalized_and_above_missing_trie_nodes_unordered</code></a>.</div></li><li><div class="item-name"><a class="struct" href="struct.MissingTrieNodeBlock.html" title="struct smoldot::database::full_sqlite::MissingTrieNodeBlock">MissingTrieNodeBlock</a></div><div class="desc docblock-short">See <a href="struct.MissingTrieNode.html#structfield.blocks" title="field smoldot::database::full_sqlite::MissingTrieNode::blocks"><code>MissingTrieNode::blocks</code></a>.</div></li><li><div class="item-name"><a class="struct" href="struct.SqliteFullDatabase.html" title="struct smoldot::database::full_sqlite::SqliteFullDatabase">SqliteFullDatabase</a></div><div class="desc docblock-short">An open database. Holds file descriptors.</div></li></ul><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.ConfigTy.html" title="enum smoldot::database::full_sqlite::ConfigTy">ConfigTy</a></div><div class="desc docblock-short">Type of database.</div></li><li><div class="item-name"><a class="enum" href="enum.CorruptedError.html" title="enum smoldot::database::full_sqlite::CorruptedError">CorruptedError</a></div><div class="desc docblock-short">Error in the content of the database.</div></li><li><div class="item-name"><a class="enum" href="enum.DatabaseOpen.html" title="enum smoldot::database::full_sqlite::DatabaseOpen">DatabaseOpen</a></div><div class="desc docblock-short">Either existing database or database prototype.</div></li><li><div class="item-name"><a class="enum" href="enum.InsertError.html" title="enum smoldot::database::full_sqlite::InsertError">InsertError</a></div><div class="desc docblock-short">Error while calling <a href="struct.SqliteFullDatabase.html#method.insert" title="method smoldot::database::full_sqlite::SqliteFullDatabase::insert"><code>SqliteFullDatabase::insert</code></a>.</div></li><li><div class="item-name"><a class="enum" href="enum.InsertTrieNodeStorageValue.html" title="enum smoldot::database::full_sqlite::InsertTrieNodeStorageValue">InsertTrieNodeStorageValue</a></div></li><li><div class="item-name"><a class="enum" href="enum.SetFinalizedError.html" title="enum smoldot::database::full_sqlite::SetFinalizedError">SetFinalizedError</a></div><div class="desc docblock-short">Error while calling <a href="struct.SqliteFullDatabase.html#method.set_finalized" title="method smoldot::database::full_sqlite::SqliteFullDatabase::set_finalized"><code>SqliteFullDatabase::set_finalized</code></a>.</div></li><li><div class="item-name"><a class="enum" href="enum.StorageAccessError.html" title="enum smoldot::database::full_sqlite::StorageAccessError">StorageAccessError</a></div><div class="desc docblock-short">Error while accessing the storage of the finalized block.</div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.open.html" title="fn smoldot::database::full_sqlite::open">open</a></div><div class="desc docblock-short">Opens the database using the given <a href="struct.Config.html" title="struct smoldot::database::full_sqlite::Config"><code>Config</code></a>.</div></li><li><div class="item-name"><a class="fn" href="fn.sqlite_version.html" title="fn smoldot::database::full_sqlite::sqlite_version">sqlite_version</a></div><div class="desc docblock-short">Returns an opaque string representing the version number of the SQLite library this binary
is using.</div></li></ul></section></div></main></body></html>